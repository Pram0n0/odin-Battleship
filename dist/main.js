(()=>{"use strict";const t=10,e=document.querySelector(".startBtn"),o=document.querySelector(".player-board"),n=document.querySelector(".npc-board");class r{constructor(t){this.length=t,this.beenHit=0}hit(){this.beenHit++}isSunk(){return this.beenHit>=this.length}}class i{constructor(){this.board=Array.from({length:t},(()=>Array(t).fill(null))),this.shipsAlive=0}placeShip(t,e,o,n){if(this.isValidShipPlacement(t,e,o,n)){for(let r=0;r<n.length;r++)"horizontal"===o?this.board[e][t+r]=n:"vertical"===o&&(this.board[e+r][t]=n);return this.shipsAlive++,!0}return!1}isValidShipPlacement(e,o,n,r){for(let i=0;i<r.length;i++){let r=e,s=o;if("horizontal"===n?r+=i:"vertical"===n&&(s+=i),r<0||r>=t||s<0||s>=t||null!==this.board[s][r])return!1}return!0}receiveAttack(t,e){const o=this.board[e][t];o?(o.hit(),o.isSunk()&&this.shipsAlive--,console.log("hit")):(this.board[e][t]="miss",console.log("miss"))}allShipsSunk(){return 0===this.shipsAlive}}class s{constructor(t,e,o){this.player=t,this.board=e,this.enemyBoard=o,this.hitsRecord=[],this.ShipList=[]}isValidAttack(e,o){return 0<=e&&e<t&&0<=o&&o<t&&!this.hitsRecord.some((t=>t[0]===e&&t[1]===o))}attack(t,e){return!!this.isValidAttack(t,e)&&(this.enemyBoard.receiveAttack(t,e),console.log(`attacked ${t},${e}`),this.hitsRecord.push([t,e]),!0)}randomAttack(){const e=Math.floor(Math.random()*t),o=Math.floor(Math.random()*t);this.attack(e,o)}createShips(){this.ShipList=[new r(2),new r(3),new r(3),new r(4),new r(5)]}randomShipPlacement(){this.ShipList.forEach((e=>{let o,n,r;do{o=Math.floor(Math.random()*t),n=Math.floor(Math.random()*t),r=Math.random()<.5?"horizontal":"vertical"}while(!this.board.placeShip(o,n,r,e))}))}}async function a(t,e,r,i,s){console.log(`Round ${i}: ${t.player}'s turn`);const l=s?o:n;0===i&&await new Promise((t=>setTimeout(t,1e3))),"NPC"===t.player?t.randomAttack():function(t){let e,o;do{e=parseInt(prompt("Enter x coordinate: ")),o=parseInt(prompt("Enter y coordinate: "))}while(!t.attack(e,o))}(t),c(l,t.enemyBoard.board,t.hitsRecord,s),function(t){return 0===t.enemyBoard.shipsAlive}(t)?console.log(`${t.player} wins!`):(await new Promise((t=>setTimeout(t,0))),t=t===e?r:e,await a(t,e,r,i+1,!s))}function l(){const{player:t,npc:e}=function(){const t=new i,e=new i,r=new s("Player",t,e);r.createShips(),r.randomShipPlacement();const a=new s("NPC",e,t);return a.createShips(),a.randomShipPlacement(),c(o,t.board,r.hitsRecord,!0),c(n,e.board,a.hitsRecord,!1),{player:r,npc:a}}();let r=function(t,e){return 1===Math.ceil(2*Math.random())?t:e}(t,e);console.log(`${r.player}'s starts`),a(r,t,e,0)}function c(e,o,n,r){console.log(`Updating board: ${e.className}`),e.innerHTML="";for(let i=0;i<t;i++)for(let s=0;s<t;s++){const t=o[i][s],a=document.createElement("div");if(a.className="cell",t)if("miss"===t)a.style.backgroundColor="red",a.textContent="miss";else{a.textContent=r?"Ship":"";const t=n.some((t=>t[1]===i&&t[0]===s));console.log(t),a.style.backgroundColor=t?"green":""}else a.textContent="";e.appendChild(a)}}e.addEventListener("click",(()=>{console.log("Start Game"),l()}))})();